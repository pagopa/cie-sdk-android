package it.pagopa.io.app.cie

import it.pagopa.io.app.cie.cie.validity_check.CieCertificateControl
import org.junit.Test
import kotlin.io.encoding.Base64
import kotlin.io.encoding.ExperimentalEncodingApi

class CieCertificateControlTest {
    val validCert by lazy {
        """LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURYekNDQWtlZ0F3SUJBZ0lVRzF1TXVmVnRFR0pzS28raDhGemxHNUlYSk1Nd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1JqRUxNQWtHQTFVRUJoTUNWVk14Q3pBSkJnTlZCQWdNQWtSRk1SVXdFd1lEVlFRS0RBeE5lVU5sY25RcwpJRWx1WXk0eEV6QVJCZ05WQkFNTUNtMTVZMlZ5ZEM1amIyMHdIaGNOTWpVd05USXlNRGMxTWpBM1doY05NelV3Ck5USXdNRGMxTWpBM1dqQkpNUXN3Q1FZRFZRUUdFd0pWVXpFTE1Ba0dBMVVFQ0F3Q1JFVXhHVEFYQmdOVkJBb00KRUVWNFlXMXdiR1ZQY21jc0lFbHVZeTR4RWpBUUJnTlZCQU1NQ1RFeU55NHdMakF1TVRDQ0FTSXdEUVlKS29aSQpodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQUxZc1BZM2NrTllZeGJQUkUwMW9vZkw5bkpCZ0hEOTFQbkNMCmVVamJUT1FyYUJFZ09Uc29rSlIvU1N2VUlLTlByZ2dSVldCc1IycjQ1SVBndXU5NGZidHJjZzAyNzdySGtFOEEKWmxDd041VTc4cmtuaVJLRXhOUUQrdWR5NmpyUGQzeCtVcEpCd2ZuTlM4L3Y3ZmtDNlRFZ3p3aVo3eTlyWlMvZQplSGhZRnBNYXFsdUZtNzk1WFFRd1RIR3lHV3VMNVFTZGNhZDYxMXhZbHI0djRiT3dacFEyK2RUb2JzRUNYT2MzCkdEOGQ0NHRvbHFONW40TXBySEdqaFB4eVF6WXdJK3BRcTNsSlJsc3IrN0tnY0J0a2RtN2QxQ2ZsOWF4QXFYVkIKMWlJSDhYWmNRSTloTFFnK1p0d2JFV0R3Yys1alQ2ZStSdHBtZnlsT2FNQnI3cmdqN2hzQ0F3RUFBYU5DTUVBdwpIUVlEVlIwT0JCWUVGSUJ0YXpaTjMzUGtUU2ovR3ZVT3kwQW9NOHFOTUI4R0ExVWRJd1FZTUJhQUZHSjJJN2RVCkRBYVhkWE90K0JyQ2M3WUV2SGJtTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElCQVFCNjZ0UExWSGgyV2VkRU8wNUkKSGZvZHhQbjlMcFBFUGQ0VS9taUdtOFMyUHM0V2o4RXZ0aHlQQWF4U2dxV3k2VE9LMEdrZS9Pajg4R0xuTDdmOQp5UnZTWUdHYnVQSW8xZVFMWmZkY0V6VktyNTBnQUVGNzlUdU1GMStWQndhZDlLeGNMU1BoN1kySHZ5cXBCcVJOCnVSb2orQytVVFNIRzdJVGU2TFNwdkdJb2h2RVR5cG1TaTF6YThzS29XQisyZW1KUVNpRHpnOE5hUWx1Ly91NHIKK2F4amIzblZKV0xNTHJwVmxsSmtmNEplQi9oUkZ0K0taQXVUWnNLbzJickoySVNHdStJSkR3dTN3cHIzdTFlMQpBMlhnSUx2eVZwTndhcXZqT1B5eDI0ZjV4S0xmcVpqQ2dQeUk0WWZJQ2M4aFpleGRLaitXTTVsb3FFcmV3MnRrCm5uRmQKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=""".trim()
    }
    val certNotValid by lazy {
        """MIIDXzCCAkegAwIBAgIUG1uMufVtEGJsKo+h8FzlG5IXJMIwDQYJKoZIhvcNAQELBQAwRjELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAkRFMRUwEwYDVQQKDAxNeUNlcnQsIEluYy4xEzARBgNVBAMMCm15Y2VydC5jb20wHhcNMjUwNTE4MTUwNTEyWhcNMjUwNTE5MTUwNTEyWjBJMQswCQYDVQQGEwJVUzELMAkGA1UECAwCREUxGTAXBgNVBAoMEEV4YW1wbGVPcmcsIEluYy4xEjAQBgNVBAMMCTEyNy4wLjAuMTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMX7N0Gt3mwy5LypgaYiWYb4sAncnq3JMM5sw3jBIcnEVABc9f+TG2DWxwH/CH941WUwc6Bq6uPg+dV3rlyQkSN7O/Rl5Ep0youikffGJcwG+pef8Zg0E4GR1i+Jo9qNm2CeWXpVGz6Q+2SLenHj0nE+Tns1sJpjIn1GAsfyHTEN9H0eMWvBuXxGJhXimfggZTZZc574VK3bG4xPwJXmwLNrUmw2jLLVLnjKGhKbZdEPGcxQTU/zjibXLf6OKB2IOKBDR/21LxahwY8lDOMfjvwQpbq+6O+H8t1N/YLtb678AIKD8ewQwFGACtmowNRFBUCb3gAKFShDDpg2SktQzpMCAwEAAaNCMEAwHQYDVR0OBBYEFAijgN23y+fI0mERMMqJ/7+1Tf/GMB8GA1UdIwQYMBaAFGJ2I7dUDAaXdXOt+BrCc7YEvHbmMA0GCSqGSIb3DQEBCwUAA4IBAQAGvQFGyM1kFRliVwwFJpirONdvm/R/zScuh07mq9pEiPfyUA+bkZ5Zs3l5yM/a9JeSFwX1M6wvb6kJBU5EP7F0gd3qskE4FnDp9ugOiLKef9L/SWbOQDCeDuI8Hxh8Pk28aScS8H3AgOcdXRXZir2tBTH/xW9Sq9TrGDBWL6g5SxWcG13DHj7xJOcW6sgk+x+4Vca/a8qCZZP313nZ+Uhl7Ff1QU/7UXvSlp24igiYWVQ2FLatKZlI5JXIJUYm1Gy5NAkisnpF0Bcczv4rpzZ7AsE2GIDAvYcABaGaT5e710woVgtlOeyu2aziepAujKdzKJf4iNfuWjYQ8MKINXG7""".trim()
    }

    @Test
    @OptIn(ExperimentalEncodingApi::class)
    fun `test on certificate validity`() {
        val clazz = CieCertificateControl(Base64.decode(validCert))
        val isValid = clazz.isCertificateValid()
        println(isValid)
        assert(isValid)
    }

    @Test
    @OptIn(ExperimentalEncodingApi::class)
    fun `test on certificate not valid`() {
        val clazz = CieCertificateControl(Base64.decode(certNotValid))
        val isValid = clazz.isCertificateValid()
        println(isValid)
        assert(!isValid)
    }
}